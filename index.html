<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Macro Plan</title>

    <!-- =============================  GLOBAL STYLES  ============================= -->
    <style>
        /* ---------- RESET & BASE TYPOGRAPHY ---------- */
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif; }
        body { background:#f9f9f9; color:#333; line-height:1.6; padding:20px; font-size:16px; }
        .container { max-width:1600px; margin:0 auto; }

        /* ---------- LOGO / SITE TITLE ---------- */
        h1 { color:#4a6741; margin-bottom:20px; text-align:center; font-size:32px; }
        h1 .logo { background:#4a6741; color:#fff; padding:3px 10px; border-radius:6px;
                   margin-right:8px; font-size:0.9em; letter-spacing:1px; }

        /* ---------- CARD ---------- */
        .card { background:#fff; border-radius:10px; padding:20px; margin-bottom:20px;
                box-shadow:0 2px 5px rgba(0,0,0,.1); }
        .card p { font-size:17px; margin-bottom:15px; }

        /* ---------- HEADINGS ---------- */
        h2 { color:#4a6741; margin-bottom:15px; font-size:24px; }
        h3 { color:#5b7a52; margin-bottom:10px; font-size:20px; }

        /* ---------- CATEGORY HEADER ---------- */
        .category-header { width:100%; padding:12px 15px; background:#dbe9db; color:#4a6741;
                           font-weight:bold; border-radius:5px; margin:20px 0 15px; font-size:18px; }

        /* ---------- TABLES ---------- */
        .food-table, #mealBreakdownTable, #columnarTotalNutritionTable {
            width:100%; border-collapse:collapse; margin-bottom:20px; table-layout:auto;
        }
        .food-table th, #mealBreakdownTable th, #columnarTotalNutritionTable th {
            background:#4a6741; color:#fff; padding:14px 10px; font-size:15px; white-space:nowrap;
            vertical-align:middle; border-bottom:1px solid #3a5033; border-right:1px solid #5b7a52;
        }
        .food-table th:first-child, #mealBreakdownTable th:first-child,
        #columnarTotalNutritionTable th:first-child { border-left:none; }
        .food-table th:last-child, #mealBreakdownTable th:last-child,
        #columnarTotalNutritionTable th:last-child { border-right:none; }

        .food-table th { text-align:left; }
        .food-table th:not(:nth-child(1)):not(:nth-child(2)) { text-align:center; }
        #mealBreakdownTable th { text-align:left; }
        #mealBreakdownTable th:not(:first-child) { text-align:center; }
        #columnarTotalNutritionTable th { background:#5b7a52; text-align:center; }

        .food-table td, #mealBreakdownTable td, #columnarTotalNutritionTable td {
            padding:14px 10px; border-bottom:1px solid #ddd; font-size:15px; vertical-align:middle;
            border-right:1px solid #e0e0e0;
        }
        .food-table td:first-child, #mealBreakdownTable td:first-child,
        #columnarTotalNutritionTable td:first-child { border-left:none; }
        .food-table td:last-child, #mealBreakdownTable td:last-child,
        #columnarTotalNutritionTable td:last-child { border-right:none; }

        .food-table td { text-align:left; }
        .food-table td:not(:nth-child(1)):not(:nth-child(2)) { text-align:center; }
        #mealBreakdownTable td:not(:first-child) { text-align:center; }
        #columnarTotalNutritionTable td { text-align:center; font-weight:bold; background:#e8f0e8; }

        .food-table tr:nth-child(even), #mealBreakdownTable tr:nth-child(even) { background:#f2f2f2; }
        .food-table tr:hover, #mealBreakdownTable tr:hover { background:#e5f0e5; }

        /* ---------- FORM ELEMENTS ---------- */
        .food-checkbox { transform:scale(1.2); margin-right:5px; }
        .food-selection { display:flex; flex-wrap:wrap; gap:15px; margin-bottom:20px; }
        .food-item { flex:1; min-width:230px; padding:15px; background:#f5f5f5; border-radius:8px; }
        .food-title { font-weight:bold; margin-bottom:10px; font-size:18px; }
        label { display:block; margin-bottom:5px; font-weight:600; font-size:17px; }
        input[type="number"] { width:100%; padding:12px; border:1px solid #ddd; border-radius:5px; font-size:17px; }

        /* ---------- BUTTONS ---------- */
        button { background:#4a6741; color:#fff; border:none; padding:14px 20px; border-radius:5px;
                 cursor:pointer; font-size:18px; }
        button:hover { background:#5b7a52; }
        .button-container { display:flex; gap:15px; margin-top:20px; }
        .button-container button { flex:1; }

        /* ---------- WRAPPERS ---------- */
        .table-wrapper { overflow-x:auto; margin-bottom:20px; }

        /* ---------- PRINT SETTINGS ---------- */
        @page { size:legal landscape; margin:10mm; }
        @media print {
            body { -webkit-print-color-adjust:exact !important; print-color-adjust:exact !important; }
            body * { visibility:hidden !important; }
            #printableReportArea, #printableReportArea * { visibility:visible !important; }
            #printableReportArea {
                position:absolute; left:0; top:0; width:98%; margin:0; padding:0; border:none; box-shadow:none; background:#fff;
            }
            header, footer { display:none !important; }           /* hide browser hdr/ftr */
            #resultsCard .button-container, #resultsCard #downloadPdfInfo { display:none !important; }
        }

        /* ---------- RESPONSIVE ---------- */
        @media (max-width:1400px){
            .food-table th,.food-table td,#mealBreakdownTable th,#mealBreakdownTable td,
            #columnarTotalNutritionTable th,#columnarTotalNutritionTable td { font-size:13px; padding:12px 8px; }
            h1 { font-size:30px; } h2 { font-size:22px; }
        }
        @media (max-width:992px){
            .food-table th,.food-table td,#mealBreakdownTable th,#mealBreakdownTable td,
            #columnarTotalNutritionTable th,#columnarTotalNutritionTable td { font-size:12px; padding:10px 6px; }
            h1 { font-size:28px; } h2 { font-size:20px; }
        }
        @media (max-width:768px){
            .food-table th,.food-table td,#mealBreakdownTable th,#mealBreakdownTable td,
            #columnarTotalNutritionTable th,#columnarTotalNutritionTable td { font-size:11px; padding:8px 5px; }
            h1 { font-size:24px; } h2 { font-size:18px; }
        }
    </style>
</head>
<body>
<div class="container">

    <!-- ===============  LOGO / TITLE  =============== -->
    <h1><span class="logo">YMP</span>Your Macro Plan</h1>

    <!-- ========================================================= -->
    <!-- ===============  STEP 1 – SELECTION  ==================== -->
    <!-- ========================================================= -->
    <div class="card" id="selectionCard">
        <h2>Step 1: Select Foods for Your Meal</h2>
        <p>Check the foods you want to include in your meal (values per 100 g or as stated):</p>

        <!-- ----------  GRAINS & STAPLES  ---------- -->
        <div class="table-wrapper">
            <div class="category-header">Grains &amp; Staples</div>
            <table class="food-table">
                <thead>
                <tr><th>Select</th><th>Food</th><th>Cals</th><th>Protein</th><th>Carbs</th><th>Fat</th>
                    <th>Zinc</th><th>Iron</th><th>Vit C</th><th>Mg</th><th>Vit B6</th><th>&Omega;‑3 ALA</th><th>&Omega;‑3 EPA/DHA</th></tr>
                </thead>
                <tbody>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="whole bread"></td><td>Whole Bread</td><td>264</td><td>11.4</td><td>45.4</td><td>4.0</td><td>1.36</td><td>3.15</td><td>0</td><td>56</td><td>0.16</td><td>150</td><td>0</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="brown rice"></td><td>Brown Rice</td><td>352</td><td>8.0</td><td>76</td><td>3.0</td><td>2.0</td><td>1.8</td><td>0</td><td>143</td><td>0.5</td><td>40</td><td>0</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="whole-wheat pasta"></td><td>Whole‑wheat Pasta</td><td>357</td><td>14</td><td>73</td><td>3.0</td><td>3.0</td><td>3.6</td><td>0</td><td>128</td><td>0.3</td><td>70</td><td>0</td></tr>
                </tbody>
            </table>
        </div>

        <!-- ----------  PROTEINS  ---------- -->
        <div class="table-wrapper">
            <div class="category-header">Proteins</div>
            <table class="food-table">
                <thead>
                <tr><th>Select</th><th>Food</th><th>Cals</th><th>Protein</th><th>Carbs</th><th>Fat</th>
                    <th>Zinc</th><th>Iron</th><th>Vit C</th><th>Mg</th><th>Vit B6</th><th>&Omega;‑3 ALA</th><th>&Omega;‑3 EPA/DHA</th></tr>
                </thead>
                <tbody>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="chicken breast"></td><td>Chicken Breast</td><td>114</td><td>22</td><td>0</td><td>3.0</td><td>0.7</td><td>0.4</td><td>0</td><td>28</td><td>0.8</td><td>13</td><td>7</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="beef 95% lean"></td><td>Beef (95% lean)</td><td>131</td><td>21</td><td>0</td><td>5.0</td><td>5.1</td><td>2.4</td><td>0</td><td>22</td><td>0.4</td><td>30</td><td>10</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="beef 90% lean"></td><td>Beef (90% lean)</td><td>170</td><td>20</td><td>0</td><td>10</td><td>4.8</td><td>2.2</td><td>0</td><td>20</td><td>0.4</td><td>30</td><td>10</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="beefLiver"></td><td>Beef Liver</td><td>135</td><td>20.4</td><td>3.9</td><td>3.6</td><td>4.0</td><td>4.9</td><td>1.0</td><td>18</td><td>0.9</td><td>20</td><td>12</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="egg" data-unit="egg"></td><td>Egg (medium)</td><td>63</td><td>5.5</td><td>0.36</td><td>4.4</td><td>0.53</td><td>0.72</td><td>0</td><td>5</td><td>0.05</td><td>40</td><td>57</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="eggWhite" data-unit="egg white"></td><td>Egg White (1 medium)</td><td>15</td><td>3.2</td><td>0.2</td><td>0.05</td><td>0.01</td><td>0.02</td><td>0</td><td>3.2</td><td>0.003</td><td>0</td><td>0</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="turkeyBreast"></td><td>Turkey Breast, skinless</td><td>114</td><td>23</td><td>0</td><td>1.4</td><td>0.90</td><td>0.50</td><td>0</td><td>30</td><td>0.81</td><td>0</td><td>0</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="salmonAtlanticWild"></td><td>Salmon, Atlantic (wild)</td><td>142</td><td>20</td><td>0</td><td>6.0</td><td>0.4</td><td>0</td><td>0</td><td>27</td><td>0.9</td><td>20</td><td>1760</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="tunaCannedLight"></td><td>Tuna, canned light</td><td>116</td><td>26</td><td>0</td><td>0.8</td><td>0.77</td><td>1.3</td><td>0</td><td>43</td><td>0.9</td><td>10</td><td>240</td></tr>
                </tbody>
            </table>
        </div>

        <!-- ----------  NUTS & SEEDS  ---------- -->
        <div class="table-wrapper">
            <div class="category-header">Nuts &amp; Seeds</div>
            <table class="food-table">
                <thead>
                <tr><th>Select</th><th>Food</th><th>Cals</th><th>Protein</th><th>Carbs</th><th>Fat</th>
                    <th>Zinc</th><th>Iron</th><th>Vit C</th><th>Mg</th><th>Vit B6</th><th>&Omega;‑3 ALA</th><th>&Omega;‑3 EPA/DHA</th></tr>
                </thead>
                <tbody>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="almonds"></td><td>Almonds</td><td>579</td><td>21.2</td><td>21.6</td><td>49.9</td><td>3.1</td><td>3.7</td><td>0</td><td>268</td><td>0.14</td><td>3</td><td>0</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="walnuts"></td><td>Walnuts</td><td>654</td><td>15.2</td><td>13.7</td><td>65.2</td><td>3.1</td><td>2.9</td><td>1.3</td><td>158</td><td>0.54</td><td>9080</td><td>0</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="pumpkin seeds"></td><td>Pumpkin Seeds</td><td>559</td><td>30.2</td><td>10.7</td><td>49.0</td><td>7.9</td><td>8.8</td><td>1.9</td><td>592</td><td>0.14</td><td>150</td><td>0</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="cashews"></td><td>Cashews</td><td>553</td><td>18.2</td><td>30.2</td><td>43.8</td><td>5.8</td><td>6.7</td><td>0.5</td><td>292</td><td>0.42</td><td>50</td><td>0</td></tr>
                </tbody>
            </table>
        </div>

        <!-- ----------  VEGETABLES & FRUITS ---------- -->
        <div class="table-wrapper">
            <div class="category-header">Vegetables &amp; Fruits</div>
            <table class="food-table">
                <thead>
                <tr><th>Select</th><th>Food</th><th>Cals</th><th>Protein</th><th>Carbs</th><th>Fat</th>
                    <th>Zinc</th><th>Iron</th><th>Vit C</th><th>Mg</th><th>Vit B6</th><th>&Omega;‑3 ALA</th><th>&Omega;‑3 EPA/DHA</th></tr>
                </thead>
                <tbody>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="apple"></td><td>Apple</td><td>52</td><td>0.26</td><td>13.8</td><td>0.17</td><td>0.04</td><td>0.12</td><td>4.6</td><td>5</td><td>0.04</td><td>7</td><td>0</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="avocado"></td><td>Avocado</td><td>160</td><td>2.0</td><td>8.5</td><td>14.7</td><td>0.64</td><td>0.55</td><td>10</td><td>29</td><td>0.26</td><td>0.11</td><td>0</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="banana"></td><td>Banana</td><td>89</td><td>1.09</td><td>22.8</td><td>0.33</td><td>0.15</td><td>0.26</td><td>8.7</td><td>27</td><td>0.37</td><td>27</td><td>0</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="broccoli"></td><td>Broccoli</td><td>34</td><td>2.82</td><td>6.64</td><td>0.37</td><td>0.41</td><td>0.73</td><td>89</td><td>21</td><td>0.18</td><td>80</td><td>0</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="carrot"></td><td>Carrot</td><td>41</td><td>0.93</td><td>9.58</td><td>0.24</td><td>0.24</td><td>0.30</td><td>5.6</td><td>12</td><td>0.14</td><td>12</td><td>0</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="cauliflower"></td><td>Cauliflower</td><td>25</td><td>1.92</td><td>4.97</td><td>0.28</td><td>0.27</td><td>0.42</td><td>44</td><td>15</td><td>0.18</td><td>21</td><td>0</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="gingerRoot"></td><td>Ginger Root</td><td>80</td><td>1.8</td><td>17.8</td><td>0.8</td><td>0.34</td><td>0.6</td><td>5</td><td>43</td><td>0.16</td><td>12</td><td>0</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="onion"></td><td>Onion</td><td>40</td><td>1.1</td><td>9.3</td><td>0.10</td><td>0.17</td><td>0.21</td><td>7.4</td><td>10</td><td>0.12</td><td>20</td><td>0</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="orange"></td><td>Orange</td><td>47</td><td>0.94</td><td>11.75</td><td>0.12</td><td>0.07</td><td>0.10</td><td>53.2</td><td>10</td><td>0.06</td><td>10</td><td>0</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="orangeJuice"></td><td>Orange Juice (raw)</td><td>45</td><td>0.70</td><td>10.0</td><td>0.20</td><td>0.05</td><td>0.20</td><td>50</td><td>11</td><td>0.10</td><td>10</td><td>0</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="pear"></td><td>Pear (with skin)</td><td>57</td><td>0.36</td><td>15.0</td><td>0.14</td><td>0.12</td><td>0.17</td><td>4.3</td><td>7</td><td>0.03</td><td>20</td><td>0</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="potato"></td><td>Potato (flesh‑only, peeled)</td><td>77</td><td>2.0</td><td>17.5</td><td>0.1</td><td>0.29</td><td>0.80</td><td>19.7</td><td>23</td><td>0.30</td><td>10</td><td>0</td></tr>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="tomato"></td><td>Tomato</td><td>18</td><td>0.88</td><td>3.9</td><td>0.20</td><td>0.17</td><td>0.27</td><td>13.7</td><td>11</td><td>0.08</td><td>19</td><td>0</td></tr>
                </tbody>
            </table>
        </div>

        <!-- ----------  OILS & FATS  ---------- -->
        <div class="table-wrapper">
            <div class="category-header">Oils &amp; Fats</div>
            <table class="food-table">
                <thead>
                <tr><th>Select</th><th>Food</th><th>Cals</th><th>Protein</th><th>Carbs</th><th>Fat</th>
                    <th>Zinc</th><th>Iron</th><th>Vit C</th><th>Mg</th><th>Vit B6</th><th>&Omega;‑3 ALA</th><th>&Omega;‑3 EPA/DHA</th></tr>
                </thead>
                <tbody>
                <tr><td><input class="food-checkbox" type="checkbox" data-food="olive oil"></td><td>Olive Oil</td><td>884</td><td>0</td><td>0</td><td>100</td><td>0</td><td>0.56</td><td>0</td><td>0</td><td>0</td><td>760</td><td>0</td></tr>
                </tbody>
            </table>
        </div>

        <div class="button-container"><button id="continueBtn">Continue to Customise Amounts</button></div>
    </div>

    <!-- ========================================================= -->
    <!-- ===============  STEP 2 – CUSTOMISE  ==================== -->
    <!-- ========================================================= -->
    <div id="customizeCard" class="card" style="display:none;">
        <h2>Step 2: Customise Food Amounts &amp; Calculate</h2>
        <p>Enter the amount for each food, then click “Add to Meal &amp; Calculate”.</p>
        <div id="selectedFoods" class="food-selection"></div>
        <div class="button-container">
            <button id="backBtn">Back to Food Selection</button>
            <button id="addToMealAndCalculateBtn">Add to Meal &amp; Calculate</button>
        </div>
    </div>

    <!-- ========================================================= -->
    <!-- ===============  STEP 3 – RESULTS  ====================== -->
    <!-- ========================================================= -->
    <div id="resultsCard" class="card" style="display:none;">
        <div id="printableReportArea">
            <h1 id="printReportHeadline" style="text-align:center;color:#333;font-size:24px;margin-bottom:10px;"></h1>
            <p id="printReportDateRange" style="text-align:center;font-size:16px;margin-bottom:20px;"></p>

            <h2>Meal Nutritional Breakdown</h2>
            <div class="table-wrapper">
                <table id="mealBreakdownTable">
                    <thead>
                    <tr>
                        <th>Food Item</th><th>Cals</th><th>Protein</th><th>Carbs</th><th>Fat</th>
                        <th>Zinc</th><th>Mg</th><th>Vit B6</th><th>Vit C</th>
                        <th>&Omega;‑3 ALA</th><th>&Omega;‑3 EPA/DHA</th><th>Iron</th>
                    </tr>
                    </thead><tbody></tbody>
                </table>
            </div>

            <h2>Total Nutrition Summary</h2>
            <div class="table-wrapper">
                <table id="columnarTotalNutritionTable"><thead></thead><tbody></tbody></table>
            </div>
        </div>

        <div class="button-container">
            <button id="editMealBtn">Edit This Meal</button>
            <button id="downloadSummaryBtn">Download Summary</button>
            <button id="startOverBtn">Start New Meal</button>
        </div>
        <p id="downloadPdfInfo" style="font-size:.9em;color:#777;margin-top:15px;text-align:center;display:none;">
            In the print dialog choose <strong>Save as PDF</strong>, paper size <strong>Legal</strong>,
            orientation <strong>Landscape</strong>, and disable headers/footers.
        </p>
    </div>
</div>

<!-- =============================  JAVASCRIPT  ============================= -->
<script>
/* ---------- FOOD DATA ---------- */
const foods = {
    "whole bread":{name:"Whole Bread",calories:264,protein:11.4,carbs:45.4,fat:4.0,zinc:1.36,magnesium:56,vitB6:0.16,ala:150,epa:0,dha:0,iron:3.15,vitC:0},
    "olive oil":{name:"Olive Oil",calories:884,protein:0,carbs:0,fat:100,zinc:0,magnesium:0,vitB6:0,ala:760,epa:0,dha:0,iron:0.56,vitC:0},
    "brown rice":{name:"Brown Rice",calories:352,protein:8.0,carbs:76,fat:3.0,zinc:2.0,magnesium:143,vitB6:0.5,ala:40,epa:0,dha:0,iron:1.8,vitC:0},
    "whole-wheat pasta":{name:"Whole‑wheat Pasta",calories:357,protein:14,carbs:73,fat:3.0,zinc:3.0,magnesium:128,vitB6:0.3,ala:70,epa:0,dha:0,iron:3.6,vitC:0},
    "chicken breast":{name:"Chicken Breast",calories:114,protein:22,carbs:0,fat:3.0,zinc:0.7,magnesium:28,vitB6:0.8,ala:13,epa:3,dha:4,iron:0.4,vitC:0},
    "beef 95% lean":{name:"Beef (95% lean)",calories:131,protein:21,carbs:0,fat:5.0,zinc:5.1,magnesium:22,vitB6:0.4,ala:30,epa:6,dha:4,iron:2.4,vitC:0},
    "beef 90% lean":{name:"Beef (90% lean)",calories:170,protein:20,carbs:0,fat:10,zinc:4.8,magnesium:20,vitB6:0.4,ala:30,epa:6,dha:4,iron:2.2,vitC:0},
    "beefLiver":{name:"Beef Liver",calories:135,protein:20.4,carbs:3.9,fat:3.6,zinc:4.0,iron:4.9,vitC:1.0,magnesium:18,vitB6:0.9,ala:20,epa:6,dha:6},
    "almonds":{name:"Almonds",calories:579,protein:21.2,carbs:21.6,fat:49.9,zinc:3.1,magnesium:268,vitB6:0.14,ala:3,epa:0,dha:0,iron:3.7,vitC:0},
    "walnuts":{name:"Walnuts",calories:654,protein:15.2,carbs:13.7,fat:65.2,zinc:3.1,magnesium:158,vitB6:0.54,ala:9080,epa:0,dha:0,iron:2.9,vitC:1.3},
    "pumpkin seeds":{name:"Pumpkin Seeds",calories:559,protein:30.2,carbs:10.7,fat:49.0,zinc:7.9,magnesium:592,vitB6:0.14,ala:150,epa:0,dha:0,iron:8.8,vitC:1.9},
    "cashews":{name:"Cashews",calories:553,protein:18.2,carbs:30.2,fat:43.8,zinc:5.8,magnesium:292,vitB6:0.42,ala:50,epa:0,dha:0,iron:6.7,vitC:0.5},
    "apple":{name:"Apple",calories:52,protein:0.26,carbs:13.8,fat:0.17,zinc:0.04,magnesium:5,vitB6:0.04,ala:7,epa:0,dha:0,iron:0.12,vitC:4.6},
    "avocado":{name:"Avocado",calories:160,protein:2.0,carbs:8.5,fat:14.7,zinc:0.64,iron:0.55,vitC:10,magnesium:29,vitB6:0.26,ala:0.11,epa:0,dha:0},
    "banana":{name:"Banana",calories:89,protein:1.09,carbs:22.8,fat:0.33,zinc:0.15,iron:0.26,vitC:8.7,magnesium:27,vitB6:0.37,ala:27,epa:0,dha:0},
    "broccoli":{name:"Broccoli",calories:34,protein:2.82,carbs:6.64,fat:0.37,zinc:0.41,magnesium:21,vitB6:0.18,ala:80,epa:0,dha:0,iron:0.73,vitC:89},
    "carrot":{name:"Carrot",calories:41,protein:0.93,carbs:9.58,fat:0.24,zinc:0.24,magnesium:12,vitB6:0.14,ala:12,epa:0,dha:0,iron:0.30,vitC:5.6},
    "cauliflower":{name:"Cauliflower",calories:25,protein:1.92,carbs:4.97,fat:0.28,zinc:0.27,magnesium:15,vitB6:0.18,ala:21,epa:0,dha:0,iron:0.42,vitC:44},
    "egg":{name:"Egg",calories:63,protein:5.5,carbs:0.36,fat:4.4,zinc:0.53,magnesium:5,vitB6:0.05,ala:40,epa:7,dha:50,iron:0.72,vitC:0},
    "eggWhite":{name:"Egg White (1 medium)",calories:15,protein:3.2,carbs:0.2,fat:0.05,zinc:0.01,iron:0.02,vitC:0,magnesium:3.2,vitB6:0.003,ala:0,epa:0,dha:0},
    "gingerRoot":{name:"Ginger Root",calories:80,protein:1.8,carbs:17.8,fat:0.8,zinc:0.34,iron:0.6,vitC:5,magnesium:43,vitB6:0.16,ala:12,epa:0,dha:0},
    "onion":{name:"Onion",calories:40,protein:1.1,carbs:9.3,fat:0.10,zinc:0.17,iron:0.21,vitC:7.4,magnesium:10,vitB6:0.12,ala:20,epa:0,dha:0},
    "orange":{name:"Orange",calories:47,protein:0.94,carbs:11.75,fat:0.12,zinc:0.07,iron:0.10,vitC:53.2,magnesium:10,vitB6:0.06,ala:10,epa:0,dha:0},
    "orangeJuice":{name:"Orange Juice (raw)",calories:45,protein:0.70,carbs:10.0,fat:0.20,zinc:0.05,iron:0.20,vitC:50,magnesium:11,vitB6:0.10,ala:10,epa:0,dha:0},
    "pear":{name:"Pear (with skin)",calories:57,protein:0.36,carbs:15.0,fat:0.14,zinc:0.12,iron:0.17,vitC:4.3,magnesium:7,vitB6:0.03,ala:20,epa:0,dha:0},
    "potato":{name:"Potato (flesh‑only, peeled)",calories:77,protein:2.0,carbs:17.5,fat:0.1,zinc:0.29,iron:0.80,vitC:19.7,magnesium:23,vitB6:0.30,ala:10,epa:0,dha:0},
    "salmonAtlanticWild":{name:"Salmon, Atlantic (wild)",calories:142,protein:20,carbs:0,fat:6.0,zinc:0.4,iron:0,vitC:0,magnesium:27,vitB6:0.9,ala:20,epa:800,dha:960},
    "tomato":{name:"Tomato",calories:18,protein:0.88,carbs:3.9,fat:0.20,zinc:0.17,iron:0.27,vitC:13.7,magnesium:11,vitB6:0.08,ala:19,epa:0,dha:0},
    "tunaCannedLight":{name:"Tuna, canned light",calories:116,protein:26,carbs:0,fat:0.8,zinc:0.77,iron:1.3,vitC:0,magnesium:43,vitB6:0.9,ala:10,epa:100,dha:140},
    "turkeyBreast":{name:"Turkey Breast, skinless",calories:114,protein:23,carbs:0,fat:1.4,zinc:0.90,iron:0.50,vitC:0,magnesium:30,vitB6:0.81,ala:0,epa:0,dha:0}
};

/* ---------- NUTRIENT ORDER & DISPLAY NAMES ---------- */
const nutrientOrder = ["calories","protein","carbs","fat","zinc","magnesium","vitB6","vitC","ala","epaDhaCombined","iron"];
const nutrientDisplayNames = {
    calories:"Calories", protein:"Protein (g)", carbs:"Carbs (g)", fat:"Fat (g)",
    zinc:"Zinc (mg)", magnesium:"Magnesium (mg)", vitB6:"Vit B6 (mg)", vitC:"Vit C (mg)",
    ala:"Ω‑3 ALA (mg)", epaDhaCombined:"Ω‑3 EPA/DHA (mg)", iron:"Iron (mg)"
};

/* ---------- ADD EPA+DHA COMBINED PROPERTY ---------- */
for(const k in foods){
    foods[k].epaDhaCombined = (foods[k].epa||0) + (foods[k].dha||0);
}

/* ---------- STATE ---------- */
let selectedFoodsForCurrentCustomization = [];
let mealItems = [];

const selectionCard = document.getElementById('selectionCard');
const customizeCard  = document.getElementById('customizeCard');
const resultsCard    = document.getElementById('resultsCard');
const selectedFoodsContainer = document.getElementById('selectedFoods');

const mealBreakdownTableBody = document.getElementById('mealBreakdownTable').querySelector('tbody');
const columnarTotalTable = document.getElementById('columnarTotalNutritionTable');
const columnarTotalThead = columnarTotalTable.tHead || columnarTotalTable.createTHead();
const columnarTotalTbody = columnarTotalTable.tBodies[0] || columnarTotalTable.createTBody();
const downloadPdfInfo = document.getElementById('downloadPdfInfo');

document.getElementById('continueBtn').addEventListener('click', goToCustomize);
document.getElementById('backBtn').addEventListener('click', () => { selectionCard.style.display='block'; customizeCard.style.display='none'; });
document.getElementById('addToMealAndCalculateBtn').addEventListener('click', processCustomizedFoodsAndCalculate);
document.getElementById('editMealBtn').addEventListener('click', prepareToEditMeal);
document.getElementById('downloadSummaryBtn').addEventListener('click', downloadSummaryAsPdf);
document.getElementById('startOverBtn').addEventListener('click', startNewMeal);

/* ---------- NAVIGATION FUNCTIONS ---------- */
function startNewMeal(){
    mealItems=[]; selectedFoodsForCurrentCustomization=[];
    document.querySelectorAll('.food-checkbox:checked').forEach(cb=>cb.checked=false);
    downloadPdfInfo.style.display='none';
    goToSelection();
}
function goToSelection(){ selectionCard.style.display='block'; customizeCard.style.display='none'; resultsCard.style.display='none'; }
function goToCustomize(){
    const boxes=[...document.querySelectorAll('.food-checkbox:checked')];
    if(boxes.length===0){ alert('Please select at least one food.'); return; }
    selectedFoodsForCurrentCustomization = boxes.map(cb=>cb.dataset.food);
    displayCustomizeInputs(false);
    selectionCard.style.display='none'; customizeCard.style.display='block'; resultsCard.style.display='none';
}
function prepareToEditMeal(){
    if(mealItems.length===0){ alert("There's no meal to edit."); goToSelection(); return; }
    displayCustomizeInputs(true);
    selectionCard.style.display='none'; customizeCard.style.display='block'; resultsCard.style.display='none';
}

/* ---------- DISPLAY INPUTS ---------- */
function displayCustomizeInputs(isEditing){
    selectedFoodsContainer.innerHTML='';
    const items = isEditing
        ? mealItems.map((item,i)=>({foodType:item.type,amount:item.amount,unit:item.unit,index:i}))
        : selectedFoodsForCurrentCustomization.map(type=>({foodType:type}));

    items.forEach((info,idx)=>{
        const f=foods[info.foodType]; if(!f) return;
        const id=`${info.foodType.replace(/\s+/g,'')}_amt_${idx}`;
        const unit= info.unit || document.querySelector(`.food-checkbox[data-food="${info.foodType}"]`)?.dataset.unit || 'grams';
        const labelTxt = (unit==='egg'||unit==='egg white') ? `Number of ${f.name}s` : `${f.name} amount (g)`;
        const placeholder = (unit==='egg'||unit==='egg white') ? 'Enter number' : 'Enter amount (g)';
        selectedFoodsContainer.insertAdjacentHTML('beforeend',
            `<div class="food-item">
                <div class="food-title">${f.name}</div>
                <label for="${id}">${labelTxt}</label>
                <input type="number" id="${id}" min="0" placeholder="${placeholder}"
                       data-food-type="${info.foodType}" data-unit="${unit}"
                       value="${isEditing ? info.amount : ''}">
             </div>`);
    });
}

/* ---------- PROCESS & CALCULATE ---------- */
function processCustomizedFoodsAndCalculate(){
    const newMeal=[]; let valid=false;
    selectedFoodsContainer.querySelectorAll('input[type=number]').forEach(inp=>{
        const val=parseFloat(inp.value); if(!val||val<=0) return;
        newMeal.push({type:inp.dataset['foodType'], amount:val, unit:inp.dataset['unit']});
        valid=true;
    });
    if(!valid){ alert('Provide a positive amount for at least one food.'); return; }
    mealItems=newMeal;
    document.querySelectorAll('.food-checkbox:checked').forEach(cb=>cb.checked=false);
    selectedFoodsForCurrentCustomization=[];
    calculateNutrition();
}

function calculateNutrition(){
    if(mealItems.length===0){
        mealBreakdownTableBody.innerHTML='<tr><td colspan="12" style="text-align:center;">Your meal is empty.</td></tr>';
        columnarTotalThead.innerHTML=''; columnarTotalTbody.innerHTML='';
        selectionCard.style.display='none'; customizeCard.style.display='none'; resultsCard.style.display='block';
        return;
    }
    const totals={}; nutrientOrder.forEach(n=>totals[n]=0);
    mealBreakdownTableBody.innerHTML=''; columnarTotalThead.innerHTML=''; columnarTotalTbody.innerHTML='';

    mealItems.forEach(item=>{
        const d=foods[item.type]; if(!d) return;
        const factor=(item.unit==='egg'||item.unit==='egg white') ? item.amount : item.amount/100;
        const row=mealBreakdownTableBody.insertRow();
        row.insertCell().textContent = d.name + (item.unit==='egg'||item.unit==='egg white'
                                               ? ` (${item.amount} ${item.unit}${item.amount>1?'s':''})`
                                               : ` (${item.amount}g)`);

        nutrientOrder.forEach(n=>{
            const val=(n==='epaDhaCombined' ? d[n] : d[n]) * factor;
            totals[n]+=val;
            row.insertCell().textContent = (n==='calories' ? val.toFixed(0) : val.toFixed(val<1?2:1));
        });
    });

    const h=columnarTotalThead.insertRow(), v=columnarTotalTbody.insertRow();
    nutrientOrder.forEach(n=>{
        h.insertCell().innerHTML=nutrientDisplayNames[n];
        v.insertCell().textContent = (n==='calories' ? totals[n].toFixed(0) : totals[n].toFixed(totals[n]<1?2:1));
    });

    selectionCard.style.display='none'; customizeCard.style.display='none'; resultsCard.style.display='block';
    downloadPdfInfo.style.display='block';
}

/* ---------- DOWNLOAD / PRINT ---------- */
function downloadSummaryAsPdf(){
    document.getElementById('printReportHeadline').textContent='Your Macro Plan Report';
    const today=new Date(), later=new Date(); later.setDate(today.getDate()+10);
    const opts={year:'numeric',month:'long',day:'numeric'};
    document.getElementById('printReportDateRange').textContent =
        `Date Range: ${today.toLocaleDateString(undefined,opts)} – ${later.toLocaleDateString(undefined,opts)}`;

    document.body.classList.add('body-is-printing');
    window.print();
    window.addEventListener('afterprint',()=>document.body.classList.remove('body-is-printing'),{once:true});
}

/* ---------- ENTER KEY SHORTCUT ---------- */
selectedFoodsContainer.addEventListener('keyup',e=>{
    if(e.target.type==='number' && e.key==='Enter') processCustomizedFoodsAndCalculate();
});
</script>
</body>
</html>
